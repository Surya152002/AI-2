<!DOCTYPE html>
<html>
<head>
  <title>Timetable Generator</title>
</head>
<body>
  <h1>Timetable Generator</h1>
  <form>
    <label for="classes">Classes:</label>
    <input type="text" id="classes" name="classes"><br><br>
    <label for="teachers">Teachers:</label>
    <input type="text" id="teachers" name="teachers"><br><br>
    <label for="rooms">Rooms:</label>
    <input type="text" id="rooms" name="rooms"><br><br>
    <label for="subjects">Subjects:</label>
    <input type="text" id="subjects" name="subjects"><br><br>
    <input type="hidden" id="class-duration" value="50">
    <input type="hidden" id="break-duration" value="5">
    <label for="slots">Slots:</label>
    <input type="text" id="slots" name="slots"><br><br>
    <input type="button" value="Generate Timetable" onclick="generateTimetable()">
  </form>
  <div id="schedule"></div>
  <script>
    const graph = [
      [0, 1, 1, 1, 1],
      [1, 0, 1, 1, 1],
      [1, 1, 0, 1, 1],
      [1, 1, 1, 0, 1],
      [1, 1, 1, 1, 0]
    ];

    // Define the weights for each edge
    const weights = [
      [0, 3, 1, 2, 3],
      [3, 0, 2, 1, 3],
      [1, 2, 0, 3, 1],
      [2, 1, 3, 0, 2],
      [3, 3, 1, 2, 0]
    ];

    function calculateEndTime(startTime, duration) {
      let hours = Math.floor((startTime + duration) / 60);
      let minutes = (startTime + duration) % 60;
      if (hours > 12) {
        hours -= 12;
      }
      return `${hours}:${minutes < 10 ? "0" : ""}${minutes}${startTime < 720 ? "am" : "pm"}`;
    }

    // Function to find the shortest Hamiltonian path through the graph
    function tsp() {
      const n = graph.length;
      const visited = new Array(n).fill(false);
      const path = new Array(n).fill(-1);

      visited[0] = true;
      path[0] = 0;

      for (let i = 1; i < n; i++) {
        let minWeight = Infinity;
        let nextNode = -1;

        for (let j = 0; j < n; j++) {
          if (!visited[j] && weights[path[i - 1]][j] < minWeight) {
            minWeight = weights[path[i - 1]][j];
            nextNode = j;
          }
        }

        visited[nextNode] = true;
        path[i] = nextNode;
      }

      // Add the last edge to complete the cycle
      path[n-1] = path[0];

      return path;
    }

    // Generate the schedule based on the TSP path
    function generateSchedule(path, classes, teachers, rooms) {
  const schedule = [];
  let time = 8;

  for (let i = 0; i < path.length - 1; i++) {
    const startTime = time * 60;
    const endTime = startTime + 50; // class duration is 50 minutes
    if (endTime <= 1230) { // school working hours till 7:30 pm
      const startTimeStr = calculateEndTime(startTime, 0);
      const endTimeStr = calculateEndTime(startTime, 50);
      const class_ = classes[path[i]];
      const teacher = teachers[path[i]];
      const room = rooms[path[i]];
      const subject = subjectsArr[path[i]];

      schedule.push({time: `${startTimeStr} - ${endTimeStr}`, class_, teacher, room, subject});
      time += 1;
    } else {
      break;
    }
  }

  return schedule;
}

    // Function to generate timetable using TSP
    function generateTimetable() {
      const classesArr = document.getElementById("classes").value.split(",");
      const teachersArr = document.getElementById("teachers").value.split(",");
      const roomsArr = document.getElementById("rooms").value.split(",");
      const subjectsArr = document.getElementById("subjects").value.split(",");
      const slots = parseInt(document.getElementById("slots").value);

      // Validate inputs
      if (!classesArr.length || !teachersArr.length || !roomsArr.length || !subjectsArr.length || !slots) {
        document.getElementById("schedule").innerHTML = "Invalid input!";
        return;
      }

      // Create a dictionary to map room names to indices
      const roomIndices = {};
      for (let i = 0; i < roomsArr.length; i++) {
        roomIndices[roomsArr[i]] = i;
      }

        // Create the graph and weights arrays based on the input arrays
  const n = classesArr.length;
  const graph = new Array(n).fill(null).map(() => new Array(n).fill(0));
  const weights = new Array(n).fill(null).map(() => new Array(n).fill(0));

  for (let i = 0; i < n; i++) {
    for (let j = 0; j < n; j++) {
      if (i !== j) {
        graph[i][j] = 1;
        weights[i][j] = Math.floor(Math.random() * 10) + 1; // Assign a random weight between 1 and 10
      }
    }
  }

  // Find the shortest Hamiltonian path through the graph
  const path = tsp();

  // Generate the schedule based on the TSP path
  const schedule = generateSchedule(path, classesArr, teachersArr, roomsArr);

  // Display the schedule on the page
const scheduleTable = document.createElement("table");
  const headerRow = scheduleTable.insertRow();
  headerRow.innerHTML = "<th>Time</th><th>Class</th><th>Teacher</th><th>Room</th>";
  let time = 8;

  for (let i = 0; i < schedule.length; i++) {
    const row = scheduleTable.insertRow();
    row.innerHTML = `<td>${time}:00am - ${time+1}:00am</td><td>${schedule[i].class_}</td><td>${schedule[i].teacher}</td><td>${schedule[i].room}</td>`;
    time++;

    if (i < schedule.length - 1 && time % slots === 0) {
      time += 5; // Add 5 minute break between classes
    }
  }

  document.getElementById("schedule").innerHTML = "";
  document.getElementById("schedule").appendChild(scheduleTable);
}
    
</script>
</body>
</html>
